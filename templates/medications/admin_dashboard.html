{% extends 'base.html' %}

{% block title %}Admin Dashboard - MedCare{% endblock %}

{% block content %}
<div class="row">
    <!-- Sidebar -->
    <div class="col-md-3">
        <div class="sidebar p-3">
            <h5 class="mb-3">
                <i class="bi bi-shield-check"></i> 
                Admin Panel
            </h5>
            
            <nav class="nav flex-column">
                <a class="nav-link active" href="{% url 'medications:admin_dashboard' %}">
                    <i class="bi bi-speedometer2"></i> Dashboard
                </a>
                <a class="nav-link" href="{% url 'medications:prescription_create' %}">
                    <i class="bi bi-plus-circle"></i> New Prescription
                </a>
                {% if user.can_manage_staff %}
                <a class="nav-link" href="{% url 'accounts:staff_register' %}">
                    <i class="bi bi-person-plus"></i> Add Staff
                </a>
                {% endif %}
                <a class="nav-link" href="{% url 'reports:report_list' %}">
                    <i class="bi bi-graph-up"></i> Reports
                </a>
                <a class="nav-link" href="{% url 'notifications:history' %}">
                    <i class="bi bi-bell"></i> Notifications
                </a>
                {% if user.can_manage_staff %}
                <a class="nav-link" href="/admin/">
                    <i class="bi bi-gear"></i> Django Admin
                </a>
                {% endif %}
            </nav>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="col-md-9">
        <div class="main-content">
            <!-- Header Stats -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="text-primary">{{ total_patients }}</h3>
                            <p class="mb-0 text-muted">Total Patients</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="text-success">{{ active_prescriptions }}</h3>
                            <p class="mb-0 text-muted">Active Prescriptions</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="text-warning">{{ pending_intakes }}</h3>
                            <p class="mb-0 text-muted">Overdue Medications</p>
                        </div>
                    </div>
                </div>
                {% if user.can_manage_staff %}
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="text-info">{{ total_staff|default:0 }}</h3>
                            <p class="mb-0 text-muted">Hospital Staff</p>
                        </div>
                    </div>
                </div>
                {% endif %}
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <a href="{% url 'medications:prescription_create' %}" class="btn btn-primary">
                                <i class="bi bi-plus-circle"></i><br>
                                New Prescription
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            {% if user.can_manage_staff %}
            <!-- Staff Management Section -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-people-fill"></i> 
                        Staff Management
                    </h5>
                    <a href="{% url 'accounts:staff_register' %}" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-person-plus"></i> Add New Staff
                    </a>
                </div>
                <div class="card-body">
                    {% if recent_staff %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Staff Member</th>
                                    <th>Department</th>
                                    <th>Contact</th>
                                    <th>Joined</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for staff in recent_staff %}
                                <tr>
                                    <td>
                                        <strong>{{ staff.get_full_name }}</strong><br>
                                        <small class="text-muted">{{ staff.username }}</small>
                                    </td>
                                    <td>{{ staff.department|default:"Not specified" }}</td>
                                    <td>
                                        {{ staff.email }}<br>
                                        <small class="text-muted">{{ staff.phone_number }}</small>
                                    </td>
                                    <td>{{ staff.date_joined|date:"M d, Y" }}</td>
                                    <td>
                                        <span class="badge bg-{% if staff.is_active %}success{% else %}secondary{% endif %}">
                                            {% if staff.is_active %}Active{% else %}Inactive{% endif %}
                                        </span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-people text-muted" style="font-size: 3rem;"></i>
                        <h6 class="text-muted mt-3">No staff members yet</h6>
                        <a href="{% url 'accounts:staff_register' %}" class="btn btn-primary mt-2">
                            <i class="bi bi-person-plus"></i> Add First Staff Member
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            
            <!-- Patient List -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-people"></i> 
                        Patient Management (Sick People)
                    </h5>
                    <a href="{% url 'notifications:send_manual' %}" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-chat-text"></i> Send Notification
                    </a>
                </div>
                <div class="card-body">
                    {% if patients %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Patient</th>
                                    <th>MRN</th>
                                    <th>Contact</th>
                                    <th>Registration Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for patient in patients %}
                                <tr>
                                    <td>
                                        <strong>{{ patient.get_full_name }}</strong><br>
                                        <small class="text-muted">{{ patient.username }}</small>
                                    </td>
                                    <td>{{ patient.medical_record_number }}</td>
                                    <td>
                                        {{ patient.email }}<br>
                                        <small class="text-muted">{{ patient.phone_number }}</small>
                                    </td>
                                    <td>{{ patient.date_joined|date:"M d, Y" }}</td>
                                    <td>
                                        <a href="{% url 'medications:patient_detail' patient.id %}" 
                                           class="btn btn-outline-primary btn-sm">
                                            <i class="bi bi-eye"></i> View
                                        </a>
                                        <a href="{% url 'reports:generate_report' patient.id %}" 
                                           class="btn btn-outline-success btn-sm">
                                            <i class="bi bi-file-text"></i> Report
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-people text-muted" style="font-size: 3rem;"></i>
                        <h6 class="text-muted mt-3">No patients (sick people) registered yet</h6>
                        <p class="text-muted">Patients can register themselves using the public registration form.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Recent Prescriptions -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-prescription2"></i> 
                        Recent Prescriptions
                    </h5>
                </div>
                <div class="card-body">
                    {% if recent_prescriptions %}
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Patient</th>
                                    <th>Medication</th>
                                    <th>Dosage</th>
                                    <th>Frequency</th>
                                    <th>Priority</th>
                                    <th>Created</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for prescription in recent_prescriptions %}
                                <tr>
                                    <td>{{ prescription.patient.get_full_name }}</td>
                                    <td>{{ prescription.medication.name }}</td>
                                    <td>{{ prescription.dosage }}</td>
                                    <td>{{ prescription.get_frequency_display }}</td>
                                    <td>
                                        <span class="badge bg-{{ prescription.priority }} text-white">
                                            {{ prescription.get_priority_display }}
                                        </span>
                                    </td>
                                    <td>{{ prescription.created_at|date:"M d, Y" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-prescription2 text-muted" style="font-size: 3rem;"></i>
                        <h6 class="text-muted mt-3">No recent prescriptions</h6>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}